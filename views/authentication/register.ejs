<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apis.google.com/js/platform.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    
    <title>Register | Spirit 2021</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600&display=swap" rel="stylesheet">
    <style>
        body{
            margin: 0px;
            background-color: black;
            font-family: 'Inter', sans-serif;
        }
        .container{
            display:grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;          
            box-sizing: border-box;
        }
        #login{
            width:50vw;
            /* height: 100vh; */
        }
        @media only screen and (max-width: 600px) {
            .container {
                display: block;   
            }
        }
        #Grid_2{
            display: grid;
            grid-template-rows: 1fr 3fr;
            justify-content: center;
            padding:20px;
            padding-top: 30px;
            padding-bottom: 10px;
            text-align: center;
            box-sizing: border-box;
        }

        #head{
            color:white;
            text-align: left;
            font-size: larger;
        }
        .auth{
            border: 2px solid grey;
            padding:20px;
            padding-left: 70px;
            padding-right: 70px;
            border-radius: 10px;
            -webkit-animation-duration: 10s;
                    animation-duration: 10s;
                    -webkit-animation-fill-mode: both;
                    animation-fill-mode: both;
        }

        #Google{
            color:white;
        }
        #Facebook{
            color:white;
        }
        #goomgle{
            color: white;
        }
        .auth:hover {
        background-color: rgb(57, 55, 55);
        border: 2px solid violet;
        }
        .Login{
            margin-top:0px;
        }
        .email{
            color:white;
            padding-top:24px;
            font-family: Inter;
        }
        a{
            text-decoration: none;
            color:white;
        }
        .itemof2{
            color:white;            
            border-radius: 4px;
            min-width: 0; min-height: 0;
            margin: 8px;
        }
        .Email{
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            align-items: center;
            justify-content: center;
        }
        .enter{
            width: 100%;
            background-color: black;
            border-radius: 10px;
            border:2px solid grey;
            height:44px;
            color:white;
            padding-left: 8px;
        }
        .enter:hover{
            border:2px solid blue;
        }
        #LOGINBUTTON{
            background-color: #C567FF;
            color:black;
            width: 100%;
            height: 50px;
            font-family: Inter;
            font-weight: 600;
            font-size:19px;
            border:2px solid violet;
            border-radius: 15px;
        }
        #LOGINBUTTON:hover{
            border:4px solid rgb(101, 101, 238);
            ;
        }
        .link{
            color:#C567FF;
        }
        #Remember{
            color:black;
        }
        #imgtext{
        
            color: white;
            height: 95vh;
        }

        .img{
            background: url('images/spirit_login.jpg');
            background-repeat: none;
            background-size: cover;
            display: grid;
                text-align: end;
                justify-content: end;
                align-items: flex-end;
                padding-right: 10px;
                padding-left: 18px;
        }
    </style>
</head>
<body>
    <section>
        <div class="container">
         <div class="img">
            <p id="imgtext">Spirit is the biggest collegiate sporting festival of North Eastern India with 3K+ participants from 65+ colleges held at IIT Guwahati.</p>
        </div>

        <div id="Grid_2" class="item">

            <div class="Login">
                <div class="customGPlusSignIn auth" id="google-signin" onclick="location.href='#';" style="cursor: pointer;"><i id="goomgle" class="fab fa-google"></i>&nbsp <a>Register with Google</a></div>
<!--  				<p class="auth" id="fb-register"><i id="goomgle" style="cursor: pointer;" class="fab fa-facebook"></i>&nbsp <a href="#">Register with Facebook</a></p> -->
                <p class="email">
                    Or register with email</p>
            </div>
            <div class="Email">
                <div class="itemof2">
                    <input id="Nameenter" class = "enter" type="text" placeholder="Name"/> 
                </div>
                <div class="itemof2">
                    <input id="Collegeenter" class = "enter" type="text" placeholder="College"/> 
                </div>
                <div class="itemof2">
                    <input id="Emailenter" class = "enter" type="email" placeholder="Email"/> 
                </div>
                <div class="itemof2">
                    <input id="Numberenter" class = "enter" type="number" placeholder="Phone number"/> 
                </div>
                <div class="itemof2">
                    <input id="Passwordenter" class = "enter"  type="password" placeholder="Password"/> 
                </div>
				<div class="itemof2">
					<p>
						<button onclick="show_pass()" id="show_pass" href="#">&nbsp&nbsp</button>Show Password &nbsp &nbsp &nbsp  &nbsp  &nbsp&nbsp 
						<a href = "#" class="link" id="forgot">Forgot Password?</a> 
					</p>
                </div>
                <div class="itemof2">
                    <button id="LOGINBUTTON">
                        Register
                    </button>
                </div>
                <div class="itemof2">
                    <p>Already have an account?&nbsp &nbsp <a class="link" href="/login">Login</a> &nbsp &nbsp   &nbsp  &nbsp&nbsp</p>
                </div>
                
            </div>  
      
        </div> 
        <script>
			var show_pass_status = false;

            var show_pass_button =document.getElementById("show_pass");

            function show_pass(){
                if(show_pass_status === false){
                    document.getElementById('Passwordenter').type= "text";
                    show_pass_button.innerHTML="✓";
                    show_pass_status = true;
                }else{
                    document.getElementById('Passwordenter').type= "password";
                    show_pass_button.innerHTML="&nbsp&nbsp";
                    show_pass_status = false;
                }
                
            }
			
			
			document.getElementById('fb-register').addEventListener('click', function () {
                    FB.login(statusChangeCallback, { scope: 'email,public_profile', return_scopes: true });
                }, false);
			
            var remember=document.getElementById("Remember");
            function rem(){remember.innerHTML="✓";}


            const form = document.getElementById('LOGINBUTTON')
            form.addEventListener('click', signupemail)
            
            async function signupemail(event) {
                event.preventDefault()
                const email = document.getElementById('Emailenter').value
                const password = document.getElementById('Passwordenter').value
                const phno = document.getElementById('Numberenter').value
                const collegename = document.getElementById('Collegeenter').value
                const username = document.getElementById('Nameenter').value
                const provider = "email";
                const result = await fetch('/authapi/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
						username,
						password,
						email,
						collegename,
						phno
					})
                }).then((res) => res.json())

                if (result.status === 'ok') {
                    // everythign went fine
                    //console.log('Got the token: ')
                    //localStorage.setItem('token', result.data)//storing data in localstorage
                    window.location.replace(`/`);
                    alert('Success. Check your mail and activate your account')
                } else {
                    alert(result.error)
                }
            }

            //calling register apis to register using google
			async function registergoogle(googleUser) {
            	var profile = googleUser.getBasicProfile();
            	//console.log('ID: ' + profile.getId());
            	const username=profile.getName();
            	//console.log('Image URL: ' + profile.getImageUrl());
            	const email = profile.getEmail();
            	const provider="google";
            	console.log('Email: ' + profile.getEmail());
           		const result = await fetch('/authapi/registerwithgofb', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email,
                    username,
                    provider
                })
            	}).then((res) => res.json())
             
            	if (result.status === 'ok') {
					var auth2 = gapi.auth2.getAuthInstance();
					auth2.signOut()
					//window.location.replace(`/profile/get/${result.data._id}`);
					window.location.replace(`/`);
                	alert('Success. Check your mail and activate your account')
            	} else {
					var auth2 = gapi.auth2.getAuthInstance();
					auth2.signOut()
                	alert(result.error)
            	}
        	}
        	
            //login loginwithgofb
            function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
                console.log('statusChangeCallback');
                console.log(response);                   // The current login status of the person.
                if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                    testAPI();  
                } else {                                 // Not logged into your webpage or we are unable to tell.
                document.getElementById('status').innerHTML = 'Please log into this webpage.';
                }
            }

            function checkLoginState() {               // Called when a person is finished with the Login Button.
                FB.getLoginStatus(function(response) {   // See the onlogin handler
                statusChangeCallback(response);
                });
            }

            window.fbAsyncInit = function() {
                FB.init({
                appId: '354191059764159',
                cookie: true,
                xfbml: true,
                version: 'v2.8'         
                });
                

                FB.getLoginStatus(function(response) {  
                    statusChangeCallback(response);        
                });
            };

            //REGISTER WITH FACEBOOK
			function testAPI() {            
    			console.log('Welcome!  Fetching your information.... ');
    			FB.api('/me?fields=name,email', async function(response) {
      				console.log('Successful login for: ' + response.name);
					const provider="facebook"
					const email=response.email
					const username=response.name
					console.log(email)
					console.log(username)
					const result = await fetch('/authapi/registerwithgofb', {
                		method: 'POST',
                		headers: {
                    		'Content-Type': 'application/json'
                		},
                		body: JSON.stringify({
                    		email,
                    		username,
                    		provider
                		})
            		}).then((res) => res.json())
             
            	if (result.status === 'ok') {
						
						//window.location.replace(`/profile/get/${result.data._id}`);
					window.location.replace(`/`);
                		alert('Success. Check your mail and activate your account')
				
					
            	} else {
                	alert(result.error);
            	}
					
    			});
  			}
              

            //google-signup  
            var googleUser = {};
            var startApp = function() {
                gapi.load('auth2', function(){
                auth2 = gapi.auth2.init({
                    client_id: '581624333892-ft1e5cqrd4ku0c9avg8hjtlikc518tuh.apps.googleusercontent.com',
                    cookiepolicy: 'single_host_origin',
                    //scope: 'additional_scope'
                });
                attachSignin(document.getElementById('google-signin'));
                });
            }

            function attachSignin(element) {
                console.log(element.id);
                auth2.attachClickHandler(element, {},
                    function(googleUser) {
                        registergoogle(googleUser);
                    }, function(error) {
                    alert(JSON.stringify(error, undefined, 2));
                });
            }

            startApp()
        </script>
    </section>
   
</body>
</html>