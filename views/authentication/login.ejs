<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apis.google.com/js/platform.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <meta name="google-signin-client_id" content="581624333892-ft1e5cqrd4ku0c9avg8hjtlikc518tuh.apps.googleusercontent.com">
	<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>
    <title>Login | Spirit 2021</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Poppins:wght@600&display=swap" rel="stylesheet">
    <style>
        body{
            margin: 0px;
            background-color: black;
            font-family: 'Inter', sans-serif;
            
        }
        .container{
            display:grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;
            
          
        }
        #login{
            width:50vw;
            height: 100vh;
        }
        @media only screen and (max-width: 600px) {
            .container {
                display: block;   
            }
        }
        #Grid_2{
            display: grid;
            grid-template-rows: 1fr 2fr;
            justify-content: center;
            padding:20px;
            text-align: center;
        }

        #head{
            color:white;
            text-align: left;
            font-size: larger;
        }
        .auth{
            border: 2px solid grey;
            padding:20px;
            padding-left: 70px;
            padding-right: 70px;
            border-radius: 10px;
            -webkit-animation-duration: 10s;
                    animation-duration: 10s;
                    -webkit-animation-fill-mode: both;
                    animation-fill-mode: both;
        }

        #fb_login{
            padding-left: 100px;
            padding-right: 100px;
        }

        #Google{
            color:white;
            
            font-weight: 100;
        }
        #Facebook{
            color:white;
        }
        #goomgle{
            color: white;
        }
        .auth:hover {
        background-color: rgb(57, 55, 55);
        border:2px solid violet;
        }
        .email{
            color:white;
            padding-top:50px;
            font-family: Inter;
        }
        a{
            text-decoration: none;
            color:white;
        }

        .itemof2{
            color:white;
            
            margin: 7px;
            
            border-radius: 4px;
        }
        @-webkit-keyframes wobble { 
                    0% { -webkit-transform: translateX(0%); } 
                    15% { -webkit-transform: translateX(-25%) rotate(-5deg); } 
                    30% { -webkit-transform: translateX(20%) rotate(3deg); } 
                    45% { -webkit-transform: translateX(-15%) rotate(-3deg); } 
                    60% { -webkit-transform: translateX(10%) rotate(2deg); } 
                    75% { -webkit-transform: translateX(-5%) rotate(-1deg); }
                    100% { -webkit-transform: translateX(0%); } 
                }
                
                @keyframes wobble { 
                    0% { transform: translateX(0%); } 
                    15% { transform: translateX(-25%) rotate(-5deg); } 
                    30% { transform: translateX(20%) rotate(3deg); } 
                    45% { transform: translateX(-15%) rotate(-3deg); } 
                    60% { transform: translateX(10%) rotate(2deg); } 
                    75% { transform: translateX(-5%) rotate(-1deg); } 
                    100% { transform: translateX(0%); } 
                }
                
                .wobble { 
                    -webkit-animation-name: wobble; 
                    animation-name: wobble; 
                }
        .Email{
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr 1fr 1fr 1fr 1fr;
            align-items: center;
            justify-content: center;
        }
        #Emailenter{
            width: 100%;
            background-color: black;
            border-radius: 10px;
            border:2px solid grey;
            height:40px;
            color:white;
            padding-left: 8px;
        }
        #Passwordenter{
            width: 100%;
            background-color: black;
            border-radius: 10px;
            border:2px solid grey;
            height:40px;
            color:white;
            padding-left: 8px;

        }
        #Emailenter:hover{
            border:2px solid blue;
            
        }
        #Passwordenter:hover{
            border:2px solid blue;
        
        }
        #LOGINBUTTON{
            background-color: #C567FF;
            color:black;
            width: 100%;
            height: 50px;
            font-family: Inter;
            font-weight: 600;
            font-size:19px;
            border:2px solid violet;
            border-radius: 15px;
        }
        #LOGINBUTTON:hover{
            border:4px solid rgb(101, 101, 238);
            ;
        }
        .link{
            color:#C567FF;
        }
        #Remember{
            color:black;
        }
        #imgtext{
        
            color: white;
            height: 95vh;
        }

        .img{
            background: url('images/spirit_login.jpg');
            background-repeat: none;
            background-size: cover;
            display: grid;
                text-align: end;
                justify-content: end;
                align-items: flex-end;
                padding-right: 10px;
                padding-left: 18px;
        }

        #show_pass{
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <section>
        <div class="container">
         <div class="img">
            <p id="imgtext">Spirit is the biggest collegiate sporting festival of North Eastern India with 3K+ participants from 65+ colleges held at IIT Guwahati.</p>
        </div>

        <div id="Grid_2" class="item">

            <div class="Login">
            <p id="head">Login</p>
           
			<!-- <div class="auth g-signin2" data-onsuccess="logingoogle">Sign in with google</div> -->
            <div class="customGPlusSignIn auth" id="google-signin" onclick="location.href='#';" style="cursor: pointer;"><i id="goomgle" class="fab fa-google"></i>&nbsp <a>Login with Google</a></div>
            <br>
            <!-- <p  class="auth" id="fb-login"><i id="goomgle"  style="cursor: pointer;"  class="fab fa-facebook"></i>&nbsp  <a href="#">Signin with Facebook</a></p> -->
            <p class="email">
                Or signin with email</p>
            </div>
            <div class="Email">
                <div class="itemof2">
                    <input id="Emailenter" type="email" placeholder="Email"/> 
                </div>
                <div class="itemof2">
                    <input id="Passwordenter" type="password" placeholder="Password"/> 
                </div>
                <div class="itemof2">
                <p>
                    <button onclick="show_pass()" id="show_pass" href="#" style = "color: #ffffff;">✓</button>Show Password &nbsp &nbsp &nbsp  &nbsp  &nbsp&nbsp 
                    <a class="link" id="forgot">Forgot Password?</a> </p>
                </div>
                <div class="itemof2">
                    <button id="LOGINBUTTON">
                        Login
                    </button>
                </div>
                <div class="itemof2">
                    <p>Not registered yet?&nbsp &nbsp <a class="link" href="/register">Create account</a> &nbsp &nbsp   &nbsp  &nbsp&nbsp</p>
                    
                </div>
                
            </div>  
      
        </div> 
        <script>
			// document.getElementById('fb-login').addEventListener('click', function () {
			// FB.login(statusChangeCallback, { scope: 'email,public_profile', return_scopes: true });
			// }, false);
			
			
            var show_pass_status = false;

            var show_pass_button =document.getElementById("show_pass");

            function show_pass(){
                if(show_pass_status === false){
                    document.getElementById('Passwordenter').type= "text";
                    //show_pass_button.innerHTML="✓";
					show_pass_button.style.color = "#000000"; 
                    show_pass_status = true;
                }else{
                    document.getElementById('Passwordenter').type= "password";
                    //show_pass_button.innerHTML="&nbsp&nbsp";
					show_pass_button.style.color = "#ffffff"; 
                    show_pass_status = false;
                }
                
            }


            const form = document.getElementById('LOGINBUTTON')
            form.addEventListener('click', loginemail)
            
            // const forgot = document.getElementById('forgot')
            // forgot.addEventListener("submit",forgotReqPass)
            
            // async function forgotReqPass(event){
            //     event.preventDefault()
            //     const email = document.getElementById('reset_email').value
            //     console.log(email)
            //     const result = await fetch('/authapi/pass_forgot_req', {
            //         method: 'POST',
            //         headers: {
            //             'Content-Type': 'application/json'
            //         },
            //         body: JSON.stringify({
            //             email
            //         })
            //     }).then((res) => res.json())
                
            //     if (result.status === 'ok') {
            //         console.log(result.data)
            //         window.location.replace(`/`)
            //         alert('Please check your email for the link to reset your password')
            //     } else {
            //         alert(result.error)
            //     }
            // }
 
            async function loginemail(event) {
                event.preventDefault()
                const email = document.getElementById('Emailenter').value
                const password = document.getElementById('Passwordenter').value
                const provider = "email";
                const result = await fetch('/authapi/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        provider
                    })
                }).then((res) => res.json())

                if (result.status === 'ok') {
                    // everythign went fine
                    //console.log('Got the token: ')
                    //localStorage.setItem('token', result.data)//storing data in localstorage
                    window.location.replace(`/`);
                    alert('Success')
                } else {
                    alert(result.error)
                }
            }
            /* function toggleview() {
                var x = document.getElementById("password");
                if (x.type === "password") {
                    x.type = "text";
                } else {
                    x.type = "password";
                }
            } */
            async function logingoogle(googleUser) {
                var profile = await googleUser.getBasicProfile();
                //console.log('ID: ' + profile.getId());
                const username=profile.getName();
                console.log('Name: ' + profile.getName());
                //console.log('Image URL: ' + profile.getImageUrl());
                const email = profile.getEmail();
                const provider="google";
                const result = await fetch('/authapi/loginwithgofb', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        username,
                        provider
                    })
                }).then((res) => res.json())
                
                if (result.status === 'ok') {
                    // everythign went fine
                    var auth2 = gapi.auth2.getAuthInstance();
                    auth2.signOut()
                    console.log('Got the token: ')
                    //localStorage.setItem('token', result.data)//storing data in localstorage
                    window.location.replace(`/`);
                    alert('Success')
                } else {
                    var auth2 = gapi.auth2.getAuthInstance();
                    auth2.signOut()
                    alert(result.error)
                }
            }
            
            //login loginwithgofb
            function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
                console.log('statusChangeCallback');
                console.log(response);                   // The current login status of the person.
                if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                    testAPI();  
                } else {                                 // Not logged into your webpage or we are unable to tell.
                document.getElementById('status').innerHTML = 'Please log into this webpage.';
                }
            }

            function checkLoginState() {               // Called when a person is finished with the Login Button.
                FB.getLoginStatus(function(response) {   // See the onlogin handler
                statusChangeCallback(response);
                });
            }

            window.fbAsyncInit = function() {
                FB.init({
                appId: '354191059764159',
                cookie: true,
                xfbml: true,
                version: 'v2.8'         
                });
                

                FB.getLoginStatus(function(response) {  
                    statusChangeCallback(response);        
                });
            };

            function testAPI() {            
                    console.log('Welcome!  Fetching your information.... ');
                    FB.api('/me?fields=name,email', async function(response) {
                        console.log('Successful login for: ' + response.name);
                        const provider="facebook"
                        const email=response.email
                        const username=response.name
                        console.log(email)
                        console.log(username)
                        const result = await fetch('/authapi/loginwithgofb', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                email,
                                username,
                                provider
                            })
                        }).then((res) => res.json())
                
                        if (result.status === 'ok') {
                            localStorage.setItem('token', result.data)//storing data in localstorage
                            window.location.replace(`/`);
                            alert('Success')
                        
                        } else {
                            alert(result.error);
                        }
                        
                    });
                }
                

            //google sign-in
            var googleUser = {};
            var startApp = function() {
                gapi.load('auth2', function(){
                // Retrieve the singleton for the GoogleAuth library and set up the client.
                auth2 = gapi.auth2.init({
                    client_id: '581624333892-ft1e5cqrd4ku0c9avg8hjtlikc518tuh.apps.googleusercontent.com',
                    cookiepolicy: 'single_host_origin',
                    // Request scopes in addition to 'profile' and 'email'
                    //scope: 'additional_scope'
                });
                attachSignin(document.getElementById('google-signin'));
                });
            }

            function attachSignin(element) {
                console.log(element.id);
                auth2.attachClickHandler(element, {},
                    function(googleUser) {
                    /* document.getElementById('').innerText = "Signed in: " +
                        googleUser.getBasicProfile().getName(); */
                        logingoogle(googleUser);
                    }, function(error) {
                    alert(JSON.stringify(error, undefined, 2));
                });
            }

            startApp()

            const forgot1 = document.getElementById('forgot')
		    forgot1.addEventListener("click",forgotReqPass)

            async function forgotReqPass(event){
			event.preventDefault()
			const email = document.getElementById('Emailenter').value
			if(!email){
				alert("Enter your email address in the form")
			}
			else{
			console.log(email)
			const result = await fetch('/authapi/pass_forgot_req', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email
                })
            }).then((res) => res.json())
			
			if (result.status === 'ok') {
                alert('Please check your email for the link to reset your password')
				console.log(result.data)
				window.location.replace(`/`)
                
            } else {
                alert(result.data)
            }
			}
		}
        </script>
    </section>
   
</body>
</html>
